# load libraries
library(tidyverse)
library(tidycensus)
library(here)
library(sf)
library(MetBrewer)
# census_api_key("YOUR KEY HERE", install = TRUE)
tenure_df <- get_decennial(
geography = "zcta",
table = "H004",
state = "CA",
year = 2010,
geometry = TRUE
)
# cleaning data
# getting zcta geography to use with all variables
geo_df <- tenure_df %>%
mutate(zcta = as.numeric(GEOID) - 600000) %>%
select(zcta, geometry) %>%
group_by(zcta) %>%
slice(1)
glimpse(geo_df)
fema_df <- read_csv(here("data", "02_processed", "ca_shape_w_suc_claims.csv") %>% str_remove("/code/census"))
fema_dis_df <- fema_df %>%
group_by(disasterNumber) %>%
add_tally(name = "num_claims_disaster") %>%
summarize(pct_claim_success = mean(i_claim_suc, na.rm=TRUE),
num_claims_disaster = mean(num_claims_disaster, na.rm=TRUE))
fema_zip_df <- fema_df %>%
#mutate(disaster_year = format(as.Date(declarationDate, format="%d/%m/%Y"), "%Y")) %>%
group_by(disasterNumber) %>%
add_tally(name = "num_claims_disaster") %>%
group_by(disasterNumber, ZCTA_USE) %>%
add_tally(name = "num_claims_disaster_zip") %>%
summarize(pct_claim_success = mean(i_claim_suc, na.rm=TRUE),
num_claims_disaster = mean(num_claims_disaster, na.rm=TRUE),
num_claims_disaster_zip = mean(num_claims_disaster_zip, na.rm=TRUE)) %>%
ungroup() %>%
arrange(num_claims_disaster, desc=TRUE)
# Adding in geometry data
map_zip_df <- geo_df %>%
left_join(fema_zip_df %>%
filter(!is.na(ZCTA_USE)),
by = c("zcta" = "ZCTA_USE"))
map_zip_4353 <- map_zip_df %>%
filter(disasterNumber == 4353)
glimpse(geo_df)
geo_df %>%
ggplot() +
geom_sf(aes(fill="grey90"))
geo_df %>%
ggplot() +
geom_sf(fill="grey90")
glimpse(geo_df)
geo_df %>%
ggplot() +
geom_sf(fill="grey90") +
geom_sf(data = map_zip_4353, aes(fill = pct_claim_success), linewidth= 0)
geo_df %>%
ggplot() +
geom_sf(fill="grey90") +
geom_sf(data = map_zip_4353, aes(fill = pct_claim_success), linewidth= 0) +
scale_fill_viridis(option="D") +
theme_classic() +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(size = 12))
library(viridis)
geo_df %>%
ggplot() +
geom_sf(fill="grey90") +
geom_sf(data = map_zip_4353, aes(fill = pct_claim_success), linewidth= 0) +
scale_fill_viridis(option="D") +
theme_classic() +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(size = 12))
View(fema_dis_df)
